{% extends 'base.html' %}
{% load static %}

{% block title %}Measurement Details - Tool Program{% endblock %}

{% block content %}
<div class="d-flex mt-4 mb-3">
    <div class="w-auto me-5">
        <h1 class="mt-2">Measurement Details</h1>
        <h4>{{ measurement.tool.name }}</h4>
    </div>
    <div class="w-auto ms-5">
        <div class="d-flex align-items-center ms-1">
            <img alt="Measure Icon" class="img-fluid" width="100" src="{% static 'images/ruler.png' %}" />
        </div>
    </div>
</div>
<hr />

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5>Measurement Information</h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-4">Tool:</dt>
                    <dd class="col-sm-8">{{ measurement.tool.name }} ({{ measurement.tool.serial_number }})</dd>
                    
                    <dt class="col-sm-4">Employee:</dt>
                    <dd class="col-sm-8">{{ measurement.employee.full_name }}</dd>
                    
                    <dt class="col-sm-4">Work Center:</dt>
                    <dd class="col-sm-8">{{ measurement.work_center.name|default:"N/A" }}</dd>
                    
                    <dt class="col-sm-4">Date Measured:</dt>
                    <dd class="col-sm-8">{{ measurement.measurement_date|date:"F d, Y g:i A" }}</dd>
                    
                    <dt class="col-sm-4">Size Measured:</dt>
                    <dd class="col-sm-8"><strong>{{ measurement.size_measured }}</strong></dd>
                    
                    {% if measurement.expected_size %}
                        <dt class="col-sm-4">Expected Size:</dt>
                        <dd class="col-sm-8">{{ measurement.expected_size }}</dd>
                    {% endif %}
                    
                    {% if measurement.tolerance %}
                        <dt class="col-sm-4">Tolerance:</dt>
                        <dd class="col-sm-8">{{ measurement.tolerance }}</dd>
                    {% endif %}
                    
                    {% if measurement.variance %}
                        <dt class="col-sm-4">Variance:</dt>
                        <dd class="col-sm-8">
                            <span class="{% if measurement.is_within_tolerance %}text-success{% else %}text-danger{% endif %}">
                                {{ measurement.variance|floatformat:4 }}
                                {% if measurement.is_within_tolerance %}
                                    <i class="fas fa-check-circle text-success ms-1"></i>
                                {% else %}
                                    <i class="fas fa-exclamation-triangle text-danger ms-1"></i>
                                {% endif %}
                            </span>
                        </dd>
                    {% endif %}
                    
                    <dt class="col-sm-4">Condition:</dt>
                    <dd class="col-sm-8">
                        <span class="badge 
                            {% if measurement.condition == 'GOOD' %}bg-success
                            {% elif measurement.condition == 'FAIR' %}bg-warning
                            {% else %}bg-danger{% endif %}">
                            {{ measurement.get_condition_display }}
                        </span>
                    </dd>
                    
                    {% if measurement.notes %}
                        <dt class="col-sm-4">Notes:</dt>
                        <dd class="col-sm-8">{{ measurement.notes }}</dd>
                    {% endif %}
                </dl>
            </div>
        </div>
        
        {% if measurement.expected_size and measurement.tolerance %}
            <div class="card mt-3">
                <div class="card-header">
                    <h5>Quality Analysis</h5>
                </div>
                <div class="card-body">
                    {% if measurement.is_within_tolerance %}
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i>
                            <strong>Within Tolerance:</strong> This measurement is within acceptable limits.
                        </div>
                    {% else %}
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>Outside Tolerance:</strong> This measurement exceeds acceptable limits.
                        </div>
                    {% endif %}
                    
                    <p><strong>Acceptable Range:</strong> 
                        {{ measurement.expected_size|floatformat:4|add:"-"|add:measurement.tolerance|floatformat:4 }} 
                        to 
                        {{ measurement.expected_size|floatformat:4|add:"+"|add:measurement.tolerance|floatformat:4 }}
                    </p>
                </div>
            </div>
        {% endif %}
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5>Tool Information</h5>
            </div>
            <div class="card-body">
                <dl>
                    <dt>Name:</dt>
                    <dd>{{ measurement.tool.name }}</dd>
                    
                    <dt>Serial Number:</dt>
                    <dd>{{ measurement.tool.serial_number }}</dd>
                    
                    {% if measurement.tool.description %}
                        <dt>Description:</dt>
                        <dd>{{ measurement.tool.description }}</dd>
                    {% endif %}
                    
                    <dt>Current Location:</dt>
                    <dd>{{ measurement.tool.location.name|default:"Unassigned" }}</dd>
                    
                    <dt>Calibration Status:</dt>
                    <dd>
                        <span class="badge {% if measurement.tool.calibrated %}bg-success{% else %}bg-warning{% endif %}">
                            {{ measurement.tool.calibration_status }}
                        </span>
                    </dd>
                </dl>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5>Actions</h5>
            </div>
            <div class="card-body">
                <a href="{% url 'measure:add' %}" class="btn btn-primary buttonPurple btn-block">Add New Measure</a>
                <a href="{% url 'measure:index' %}" class="btn btn-secondary btn-block mt-2">Back to List</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}